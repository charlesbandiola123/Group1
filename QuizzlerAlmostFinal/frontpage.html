<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="logo.ico" />
  <title>Quizzler</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(to right, #8D72E1, #e0b7fc);
      text-align: center;
      font-family: Arial, sans-serif;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 40px;
      background: linear-gradient(to right, #8D72E1, #6C4AB6);
      border-bottom: 2px solid white;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 80px;
      height: auto;
    }

    .title {
      font-size: 60px;
      font-family: fantasy;
      color: white;
      white-space: nowrap;
    }

    .button-container {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    button, .button-container a.button-link {
      padding: 5px 10px;
      border: 2px solid white;
      cursor: pointer;
      border-radius: 50px;
      background-color: #ffffff;
      color: black;
      text-decoration: none;
      font-family: Arial, sans-serif;
      font-size: inherit;
      display: inline-block;
    }
    .button-container span.welcome-message {
        color: white;
        margin-right: 15px;
        font-size: 16px;
    }

    /* Styles for the new burger menu */
    .burger-menu-wrapper {
      position: relative;
      display: inline-block;
    }

    .burger-toggle-btn {
      padding: 5px 10px; /* Match other buttons */
      border: 2px solid white;
      cursor: pointer;
      border-radius: 50px;
      background-color: #ffffff;
      color: black;
      font-size: 18px; /* Adjust for burger icon size */
      line-height: 1; /* Ensure icon is centered */
    }
    .burger-toggle-btn:hover {
      background-color: #f0f0f0;
    }

    .dropdown-content-burger {
      display: none; /* Hidden by default */
      position: absolute;
      right: 0; /* Align to the right of the button */
      top: 100%; /* Position below the button */
      background-color: white;
      min-width: 120px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1000; /* Ensure it's on top */
      border-radius: 8px;
      margin-top: 5px; /* Small gap */
    }

    .dropdown-content-burger button {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      background: none;
      cursor: pointer;
      font-family: Arial, sans-serif;
      font-size: 14px;
      border-radius: 0; /* Reset border-radius for items unless on hover */
    }

    .dropdown-content-burger button:hover {
      background-color: #f1f1f1;
      border-radius: 8px; /* Match dropdown's border-radius on hover */
    }


    .create {
      border-radius: 50px;
      width: 250px;
      height: 100px;
      color: white;
      background-color: #8D72E1;
      font-size: 35px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    }

    .create-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 50px;
    }

    .saved-terms-container {
      margin-top: 50px;
      padding: 20px;
      background: rgb(229, 198, 255);
      color: rgb(112, 112, 112);
      border-radius: 10px;
      width: 80%;
      max-width: 600px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .project-box {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      width: 90%;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
      text-align: center;
      position: relative;
    }
    .project-box h3 {
      display: inline-block;
      text-align: center;
      width: 100%;
    }

    .menu-container {
      position: absolute;
      top: 50px;
      left: 0;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 999;
      display: none;
      flex-direction: column;
      min-width: 160px;
    }

    .menu-container button {
      padding: 10px 20px;
      border: none;
      border-radius: 0; /* Reset from general button style */
      background: white;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      text-align: left;
    }

    .menu-container button:hover {
      background: rgb(240, 240, 240);
    }

    .toggle-section {
      margin-top: 20px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .toggle-button {
      padding: 10px 20px;
      border-radius: 30px;
      border: none;
      background-color: #6C4AB6;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }

    .delete-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      padding: 5px 10px;
      border-radius: 30px;
      border: none;
      background-color: #e74d3c00;
      color: #333;
      font-size: 18px;
      cursor: pointer;
    }
    .delete-btn:hover {
      background-color: rgba(0,0,0,0.05);
    }

    @media (max-width: 600px) {
      .header {
        flex-direction: column;
        align-items: center;
        padding: 10px;
      }

      .button-container {
        margin-top: 10px;
        flex-wrap: wrap; /* Allow buttons to wrap on small screens */
        justify-content: center; /* Center buttons when they wrap */
      }

      .title {
        font-size: 40px;
      }

      .create {
        width: 200px;
        height: 80px;
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-container">
      <img src="logo.ico" alt="Logo" class="logo" />
      <span class="title">QUIZZLER</span>
    </div>
    <!-- Container for Logged-Out state -->
    <div class="button-container" id="auth-buttons-default">
      <button class="signup">Sign Up</button>
      <button class="login">Log In</button>
      <!-- Burger Menu for Tutorial -->
      <div class="burger-menu-wrapper">
        <button id="burger-menu-toggle" class="burger-toggle-btn" aria-label="Open Menu">‚ò∞</button> <!-- Burger icon -->
        <div id="tutorial-dropdown-menu" class="dropdown-content-burger">
          <button id="tutorial-action-button">Tutorial?</button>
        </div>
      </div>
    </div>
    <!-- Container for Logged-In state (initially hidden) -->
    <div class="button-container" id="auth-buttons-loggedin" style="display:none;">
      <span class="welcome-message" id="welcome-user-message"></span>
      <a href="#" id="logout-action-link" class="button-link">Log Out</a>
    </div>
  </div>

  <div class="create-page">
    <a href="addpage.html?mode=create">
      <button class="create">CREATE</button>
    </a>

    <div class="toggle-section">
      <button id="viewToggleBtn" class="toggle-button">My Project ‚ñº</button>
      <div id="toggleMenu" class="menu-container">
        <button data-view="project">My Project</button>
        <button data-view="quiz">My Quizzes</button>
      </div>
    </div>

    <div class="saved-terms-container" id="termsBox"></div>
    <div class="saved-terms-container" id="quizzesBox" style="display: none;"></div>
  </div>

  <script>
    // Function to read a cookie
    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
        }
        return null;
    }

    // Function to load saved projects
    function loadSavedProjects() {
        let projects = JSON.parse(localStorage.getItem("projects")) || {};
        let displayContainer = document.getElementById("termsBox");

        if (!displayContainer) {
            console.error("Element with ID 'termsBox' not found for displaying projects.");
            return;
        }
        displayContainer.innerHTML = ""; // Clear previous content
        if (Object.keys(projects).length > 0) {
            Object.keys(projects).forEach((title) => {
                let projectBox = document.createElement("div");
                projectBox.classList.add("project-box");

                const deleteBtn = document.createElement("button");
                deleteBtn.classList.add("delete-btn");
                deleteBtn.innerHTML = "üóëÔ∏è";
                deleteBtn.addEventListener("click", function (e) {
                    e.stopPropagation(); // Prevent triggering projectBox click
                    if (confirm("Are you sure you want to delete this project?")) {
                        delete projects[title];
                        localStorage.setItem("projects", JSON.stringify(projects));
                        projectBox.remove(); // Remove the element from DOM
                        if (Object.keys(projects).length === 0) {
                            displayContainer.innerHTML = "<p>No saved projects yet.</p>";
                        }
                    }
                });

                projectBox.innerHTML = `<h3>${title}</h3>`;
                projectBox.appendChild(deleteBtn);

                projectBox.addEventListener("click", function () {
                    localStorage.setItem("selectedProject", JSON.stringify(projects[title]));
                    localStorage.setItem("projectTitle", title);
                    window.location.href = "print.html";
                });
                displayContainer.appendChild(projectBox);
            });
        } else {
            displayContainer.innerHTML = "<p>No saved projects yet.</p>";
        }
    }

    // Function to load saved quizzes
    function loadSavedQuizzes() {
      const quizzes = JSON.parse(localStorage.getItem("savedQuizzes") || "[]");
      const quizzesBox = document.getElementById("quizzesBox");

      if (!quizzesBox) {
          console.error("Element with ID 'quizzesBox' not found for displaying quizzes.");
          return;
      }
      quizzesBox.innerHTML = ""; // Clear previous content
      if (quizzes.length > 0) {
        quizzes.forEach((quiz, index) => {
          const quizBox = document.createElement("div");
          quizBox.classList.add("project-box");

          const deleteBtn = document.createElement("button");
          deleteBtn.classList.add("delete-btn");
          deleteBtn.innerHTML = "üóëÔ∏è";
          deleteBtn.addEventListener("click", function (e) {
            e.stopPropagation(); // Prevent triggering quizBox click
            if (confirm("Are you sure you want to delete this quiz?")) {
                quizzes.splice(index, 1); // Remove quiz from array
                localStorage.setItem("savedQuizzes", JSON.stringify(quizzes));
                quizBox.remove(); // Remove the element from DOM
                if (quizzes.length === 0) {
                    quizzesBox.innerHTML = "<p>No saved quizzes yet.</p>";
                }
            }
          });

          quizBox.innerHTML = `<h3>${quiz.title}</h3>`;
          quizBox.appendChild(deleteBtn);

          quizBox.addEventListener("click", function () {
            localStorage.setItem("selectedQuiz", JSON.stringify(quiz));
            if (quiz.type === "multiplechoice") {
              window.location.href = "multiplechoice.html";
            } else if (quiz.type === "identification") {
              window.location.href = "identification.html";
            }
          });
          quizzesBox.appendChild(quizBox);
        });
      } else {
        quizzesBox.innerHTML = "<p>No saved quizzes yet.</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      // REMOVED: Initial Tutorial Prompt block

      // Auth buttons and user state logic
      const defaultAuthContainer = document.getElementById('auth-buttons-default');
      const loggedInAuthContainer = document.getElementById('auth-buttons-loggedin');
      const welcomeUserMessage = document.getElementById('welcome-user-message');
      const logoutActionLink = document.getElementById('logout-action-link');

      const isLoggedIn = getCookie("isLoggedIn") === "true";
      const username = getCookie("username");

      if (isLoggedIn) {
          defaultAuthContainer.style.display = 'none';
          loggedInAuthContainer.style.display = 'flex';
          if (username) {
              welcomeUserMessage.textContent = 'Welcome, ' + username + '!';
          } else {
              welcomeUserMessage.textContent = 'Welcome!';
          }
          logoutActionLink.addEventListener('click', function(e) {
              e.preventDefault();
              window.location.href = 'logout.php';
          });
      } else {
          defaultAuthContainer.style.display = 'flex';
          loggedInAuthContainer.style.display = 'none';

          const signupButton = defaultAuthContainer.querySelector(".signup");
          if (signupButton) {
              signupButton.addEventListener("click", function () {
                window.location.href = "signup.html";
              });
          }

          const loginButton = defaultAuthContainer.querySelector(".login");
          if (loginButton) {
              loginButton.addEventListener("click", function () {
                window.location.href = "login.html";
              });
          }

          // Burger Menu (Tutorial) Logic - only for logged-out state
          const burgerMenuToggle = document.getElementById('burger-menu-toggle');
          const tutorialDropdownMenu = document.getElementById('tutorial-dropdown-menu');
          const tutorialActionButton = document.getElementById('tutorial-action-button');

          if (burgerMenuToggle && tutorialDropdownMenu && tutorialActionButton) {
              burgerMenuToggle.addEventListener('click', function(event) {
                  event.stopPropagation();
                  const isDisplayed = tutorialDropdownMenu.style.display === 'block';
                  tutorialDropdownMenu.style.display = isDisplayed ? 'none' : 'block';
              });

              tutorialActionButton.addEventListener('click', function() {
                  window.location.href = 'tutorial.html';
              });

              // Close tutorial dropdown if clicked outside
              document.addEventListener('click', function(event) {
                  if (tutorialDropdownMenu.style.display === 'block' &&
                      !burgerMenuToggle.contains(event.target) &&
                      !tutorialDropdownMenu.contains(event.target)) {
                      tutorialDropdownMenu.style.display = 'none';
                  }
              });
          } else {
              console.warn("Burger menu elements (tutorial) not found.");
          }
      }

      // "My Project" / "My Quizzes" Dropdown Logic
      const dropdownToggle = document.getElementById("viewToggleBtn");
      const dropdownMenu = document.getElementById("toggleMenu");
      const termsBox = document.getElementById("termsBox");
      const quizzesBox = document.getElementById("quizzesBox");

      if (dropdownToggle && dropdownMenu && termsBox && quizzesBox) {
          dropdownToggle.addEventListener("click", (event) => {
            event.stopPropagation();
            dropdownMenu.style.display = dropdownMenu.style.display === "flex" ? "none" : "flex";
          });

          dropdownMenu.addEventListener("click", function (e) {
            if (e.target.tagName === "BUTTON") {
              const view = e.target.getAttribute("data-view");
              if (view === "project") {
                termsBox.style.display = "flex";
                quizzesBox.style.display = "none";
                dropdownToggle.textContent = "My Project ‚ñº";
              } else if (view === "quiz") {
                termsBox.style.display = "none";
                quizzesBox.style.display = "flex";
                dropdownToggle.textContent = "My Quizzes ‚ñº";
              }
              dropdownMenu.style.display = "none"; // Close menu after selection
            }
          });
          // Close "My Project" dropdown if clicked outside
          document.addEventListener('click', function(event) {
            if (dropdownMenu.style.display === 'flex' &&
                !dropdownToggle.contains(event.target) &&
                !dropdownMenu.contains(event.target)) {
                dropdownMenu.style.display = 'none';
            }
          });
      } else {
          console.warn("Dropdown toggle or menu elements for Project/Quiz view not found.");
      }

      // Load saved projects and quizzes from localStorage
      loadSavedProjects();
      loadSavedQuizzes();
    });
  </script>
</body>
</html>